<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" href="/css/community/community_detail.css">
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>
<body>


<main class="qna-detail">
    <article class="qna-detail__container container">
        <section class="qna-detail__container__content">
            <header class="qna-detail__content__header-container">

                <div class="qna-detail__content__header-top">
                    <a class="qna-detail__content__header-subtitle" th:href="@{/community/list(currentPageNo=${currentPageNo}, reply=${reply}, orderType =${orderType} , searchType=${criteria.searchType}, searchKeyword=${criteria.searchKeyword})}">질문과 답변</a>
                </div>
                <h1 class="qna-detail__content__header-title" th:text="${community.communityTitle +' <' + community.communityState+ '>'}"></h1>
                <address class="qna-detail-author qna-detail__content__header-author-section">
                    <a class="qna-detail-author__profile-link" href="/users/11237952">
                        <div class="qna-detail-author__profile-link__image">
                            <img src="https://image.ohou.se/i/bucketplace-v2-development/uploads/default_images/avatar.png?gif=1&amp;w=72&amp;h=72&amp;c=c" srcset="https://image.ohou.se/i/bucketplace-v2-development/uploads/default_images/avatar.png?gif=1&amp;w=144&amp;h=144&amp;c=c 1.5x,https://image.ohou.se/i/bucketplace-v2-development/uploads/default_images/avatar.png?gif=1&amp;w=144&amp;h=144&amp;c=c 2x,https://image.ohou.se/i/bucketplace-v2-development/uploads/default_images/avatar.png?gif=1&amp;w=240&amp;h=240&amp;c=c 3x">
                        </div>
                        <div class="qna-detail-author__profile-link__summary">
                            <div class="qna-detail-author__profile-link__summary-section">
                                <span class="qna-detail-author__profile-link__summary-nickname" th:text="${community.memberId}"></span>
                            </div>
                        </div>
                    </a>
                </address>
            </header>
            <section class="qna-detail__content__body">
                <th:block th:if="${community.communityImg ne null}">
                    <img th:src="@{${'/img/community/uploadCommunityImg/'+community.communityImg}}">
                </th:block>
                <p th:text="${community.communityContents}"></p>
            </section>

            <footer class="qna-detail__footer">

                <aside class="qna-detail-actions qna-detail__footer__action-group">
                    <div class="drop-down qna-detail-actions__wrapper">
                        <button class="button button--color-gray-14-inverted button--size-30 button--shape-round qna-detail-actions__action" type="button">
                            <svg class="qna-detail-actions__action__icon" aria-label="공유하기" width="28" height="28" viewBox="0 0 28 28" preserveAspectRatio="xMidYMid meet">
                                <g fill="none" fill-rule="evenodd">
                                    <g transform="translate(-124 -11)">
                                        <path d="M124 11h28v28h-28z"></path>
                                        <g stroke="#757575" transform="translate(126 12)">
                                            <circle cx="5" cy="13" r="4.5"></circle>
                                            <circle cx="19" cy="21" r="4.5"></circle>
                                            <circle cx="19" cy="5" r="4.5"></circle>
                                            <path stroke-linecap="square" d="M8.5 10.5l6-4M8.5 15.5l6 4"></path>
                                        </g>
                                    </g>
                                </g>
                            </svg>
                            <span class="qna-detail-actions__action__label">공유</span>
                        </button>
                    </div>
                </aside>
                <div class="qna-detail__footer__metadata">
                    <time class="qna-detail_time" th:text="${community.communityCreatedDate}"></time>
                    <span>조회<span class="qna-detail__footer__metadata-view-count-value" th:text="${community.communityHit}"></span></span>
                </div>

                <div class="header_btn">
                    <!--수정, 삭제는 현재 로그인 된 아이디와 해당 문의글의 작성 아이디가 같을 때만 보이게 처리할 것-->
                    <button type="button" class="btn btn-default modifyBtn" id="modify_btn"><a href="#">수정</a></button>
                    <button type="button" class="btn btn-default deleteBtn" id="delete_btn"><a th:href="@{/community/community_delete(communityId=${community.communityId})}">삭제</a></button>
                    <button type="button" class="btn btn-default listBtn" id="boardList_btn"><a th:href="@{/community/list(currentPageNo=${currentPageNo}, reply=${reply}, orderType =${orderType} , searchType=${criteria.searchType}, searchKeyword=${criteria.searchKeyword})}">목록</a></button>
                </div>

            </footer>



            <section class="qna-detail__comment-section">
                <section class="comment-feed">
                    <h1 class="comment-feed__header">답변</h1>
                    <form class="comment-feed__form" id="comment-feed__form" name="commentForm" onsubmit="commemntInsert_CheckForm(this); return false;">
                        <div class="comment-feed__form__user">
                            <img src="https://image.ohou.se/i/bucketplace-v2-development/uploads/default_images/avatar.png?gif=1&amp;w=36" srcset="https://image.ohou.se/i/bucketplace-v2-development/uploads/default_images/avatar.png?gif=1&amp;w=72 1.5x,https://image.ohou.se/i/bucketplace-v2-development/uploads/default_images/avatar.png?gif=1&amp;w=72 2x,https://image.ohou.se/i/bucketplace-v2-development/uploads/default_images/avatar.png?gif=1&amp;w=144 3x">
                        </div>
                        <div class="comment-feed__form__input">
                            <div class="comment-feed__form__content">
                                <div class="comment-content-input">
                                    <input type="text" name="commentContents" id="commentContents"class="comment-content-input__text comment-feed__form__content__text"/>
                                </div>
                            </div>
                            <div class="comment-feed__form__actions" >
                                <input class="comment-feed__form__submit" id="commentBtn" type="submit"  value="등록"/>
                            </div>
                        </div>
                        <input type="hidden" name="communityId" th:value="${community.communityId}">
                        <input type="hidden" name="reply" th:value="${reply}">
                        <input type="hidden" name="orderType" th:value="${orderType}">
                        <input type="hidden" name="currentPageNo" th:value="${currentPageNo}">
                        <input type="hidden" name="searchType" th:value="${criteria.searchType}">
                        <input type="hidden" name="searchKeyword" th:value="${criteria.searchKeyword}">
                        <input type="hidden" name="commentCurrentPage" th:value="${commentCurrentPage}">
                    </form>



                      <ul class="comment-feed__list"></ul>


                </section>
            </section>


            <div class="paging">
                <ul class="pagination">
                    <!--이전  버튼-->
                    <th:block th:if="${commentPageMaker.hasPreviousPage}">
                        <li class="page-item">
                            <a class ="page-link" id="Previous"  th:href="@{/community/detail(communityId=${community.communityId},commentCurrentPage=${commentPageMaker.firstPage - 1}, currentPageNo=${currentPageNo}, reply=${reply}, orderType =${orderType} , searchType=${criteria.searchType}, searchKeyword=${criteria.searchKeyword})}" tabindex="-1">Prev</a>
                        </li>
                    </th:block>



                    <!--페이지 번호-->
                    <th:block th:each="page: ${#numbers.sequence(commentPageMaker.firstPage, commentPageMaker.lastPage)}">
                        <li class="page-item" th:classappend="${commentCurrentPage == page} ?'active':''"
                            th:attr="id=${commentCurrentPage == page} ? 'pageActive' : 'pageNoActive'" >
                            <a class ="page-link" id="pageNum"  th:href="@{/community/detail(communityId=${community.communityId},commentCurrentPage=${page},currentPageNo=${currentPageNo}, reply=${reply}, orderType =${orderType} , searchType=${criteria.searchType}, searchKeyword=${criteria.searchKeyword})}" th:text="${page == 0 ? '': page}" ></a>
                        </li>
                    </th:block>


                    <!--다음 버튼-->
                    <th:block th:if="${commentPageMaker.hasNextPage}">
                        <li class="page-item" >
                            <a class ="page-link" id="Next" th:href="@{/community/detail(communityId=${community.communityId},commentCurrentPage=${commentPageMaker.lastPage + 1}, currentPageNo=${currentPageNo}, reply=${reply}, orderType =${orderType} , searchType=${criteria.searchType}, searchKeyword=${criteria.searchKeyword})}"  tabindex="-1">Next</a>
                        </li>
                    </th:block>


                </ul>
            </div>


        <!-- 하단-->
        </section>
    </article>

    <aside class="qna-detail-aside qna-detail__aside">
        <div class="qna-detail-aside__section">
            <h2 class="qna-detail-aside__section__header">궁금한 것 물어보세요!</h2>
            <a class="button button--color-blue button--size-60 button--shape-4 qna-detail-aside__section__new-question-button" type="button" th:href="@{/community/list(currentPageNo=${currentPageNo}, reply=${reply}, orderType =${orderType} , searchType=${criteria.searchType}, searchKeyword=${criteria.searchKeyword})}">질문하러 가기</a>
        </div>
    </aside>




</main>






<script>




    $(document).ready(function(){
        getCommentList();
    });

    function getCommentList(){

      let communityId = document.commentForm.communityId.value;
      let commentCurrentPage = document.commentForm.commentCurrentPage.value;
        let commentbean ={
          commentCurrentPage: commentCurrentPage
      };
      let url =  '/community/commentlist/'+communityId;


      $.post(
           url,
           commentbean,
          function(result) {
              let comments = "";
              if (result.length < 1) {
                  comments = "등록된 댓글이 없습니다.";
              } else {
                  $(result).each(function () {

                      comments += '<li className="comment-feed__list__item">';
                      comments += '<article className="comment-feed__item">';
                      comments += '<p className="comment-feed__item__content">';
                      comments += '<a href="/users/13759551" className="comment-feed__item__content__author" style=" color: #424242; font-weight: 700; font-size: 15px; margin-top: 10px; margin-right: 5px;">';
                      comments += '<img className="comment-feed__item__content__author__image" src="https://image.ohou.se/i/bucketplace-v2-development/uploads/default_images/avatar.png?gif=1&amp;w=36"';
                      comments += ' srcSet="https://image.ohou.se/i/bucketplace-v2-development/uploads/default_images/avatar.png?gif=1&amp;w=72 1.5x,https://image.ohou.se/i/bucketplace-v2-development/uploads/default_images/avatar.png?gif=1&amp;w=72 2x,https://image.ohou.se/i/bucketplace-v2-development/uploads/default_images/avatar.png?gif=1&amp;w=144 3x" style="width: 30px; height: 30px; margin-right: 10px; border-radius: 100%; background-color: #dbdbdb; float: left; margin-top: 5px;"></img>';
                      comments += '<span className="comment-feed__item__content__author__name">';
                      comments +=  this.memberId;
                      comments += '</span></a><span className="comment-feed__item__content__content" style="white-space:pre-line; display:block; font-size: 15px; font-family: inherit ; margin-top: 5px; ">';
                      comments +=  this.commentContents;
                      comments += '</span></p><footer className="comment-feed__item__footer">';
                      comments += '<time className="comment-feed__item__footer__time" style="font-weight: bold; margin-left: 40px; color: #757575; font-size: 14px;" >';
                      comments +=  this.commentCreatedDate;
                      comments += '</time>';
                      comments +=  '<span style="color: rgb(189, 189, 189); font-size: 13px; font-weight: bold; margin: 0px 5px;">·</span>';
                      comments += '<button className="comment-feed__item__footer__reply-btn" type="button" style="background: none; border: none;  color: rgb(117, 117, 117);  padding: 0;  font-size: 13px;  font-weight: bold;  font-family: inherit;">답글 달기</button>';
                      comments +=  '<span style="color: rgb(189, 189, 189); font-size: 13px; font-weight: bold; margin: 0px 5px;">·</span>';
                      comments += '<button className="comment-feed__item__footer__delete-btn" type="button" style="background: none; border: none;  color: rgb(117, 117, 117);  padding: 0;  font-size: 13px;  font-weight: bold;  font-family: inherit;">삭제</button></footer></article></li>';
                      $(".comment-feed__list").html(comments);

                  });
              }

          },
          'json'
      );

    }




    function commemntInsert_CheckForm(form){

        let community_Id = form.communityId.value.trim();
        let comment_Contents = form.commentContents.value.trim();
        let member_Id = 3;

     if(comment_Contents == null || comment_Contents == ''){
         alert('답글을 입력해주세요.');
         form.commentContents.focus();
         return;

     }
        let commentBean = {
            communityId: community_Id,
            commentContents : comment_Contents,
            reply: form.reply.value,
            orderType: form.orderType.value,
            currentPageNo: form.currentPageNo.value,
            searchType: form.searchType.value,
            searchKeyword: form.searchKeyword.value

        };
      let url_data = '/community/commentInsert/' + community_Id +'/'+ member_Id +'/'+ comment_Contents;

     $.post({
         url: url_data,
         data: commentBean,
         dataType: 'json',
         success: function (result) {
             getCommentList();
             form.commentContents.value = '';

         },
         error: function (error) {
             console.log("에러 :" + error);
         }
     });

    }






</script>


</body>
</html>